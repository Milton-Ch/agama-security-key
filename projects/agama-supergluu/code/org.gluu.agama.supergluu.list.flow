// This list flow is responsible for listing or editing the Super Gluu devices that the logged-in user has registered
Flow org.gluu.agama.supergluu.list
     Basepath ""
     Inputs userData scimSetting
// Mark log startup
Log "@debug List flow started"
// Set inum = userData.inum
inum = userData.inum
scimFido2Helper = Call org.gluu.agama.supergluu.ScimFido2Helper#new scimSetting
fidoDevice = Call scimFido2Helper getFidoDeviceByUser inum
obj = { fidoDevice: fidoDevice, showError: false, errorTitle: "", errorMessage: "", canEdit: false }
Repeat 5 times max
     listForm = RRF "list.ftlh" obj
     Log "@debug List form response %" listForm
     When listForm.deviceId is not null and listForm.deviceId is not ""
          obj.canEdit = false
          obj.showError = false
          nickNamed | E = Call scimFido2Helper updateDevice inum listForm.deviceId listForm.nickname
          When E is not null
               obj.showError = true
               obj.errorTitle = "Failed to set a nickname"
               obj.errorMessage = E.message
          Otherwise
               obj.fidoDevice = Call scimFido2Helper getgetFidoDeviceByUser inum
When listForm.addBtn is ""
When 
When 
     obj.canEdit = true
     obj.showError = false
When listForm.cancelItemBtn is ""
     obj.canEdit = false
     obj.showError = false