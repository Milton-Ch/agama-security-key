// This flow handles the registration of a new super gluu device
Flow org.gluu.agama.supergluu.add
     Basepath ""
     Configs conf
     Inputs userData scimSetting
// Mark startup logs
Log "@debug Add a super gluu flow is started"
// Load pre-enrollment.ftlh page
obj = RRF "pre-enrollment.ftlh" 
When obj.cancelBtn is ""
     // Finish with cancellation event
     it_inuvz = {success:false, error: "Pre enrollment cancelled"}
     Finish it_inuvz
// Set inum = userData.inum
inum = userData.inum
// Get instance SGValidator
sgEnroller = Call org.gluu.agama.supergluu.SGValidator#new scimSetting
// Generate enrollment request
req = Call scimSetting QRRequest null
Log "@debug Enrollment request generated %" req
// Set dn = data.first
dn = data.first
When dn is null
     it_ohbsv = {success:false, error: "data.second"}
     Finish it_ohbsv
// Flow to assign a nickname to the registered super gluu
nicknameTrigger = Trigger org.gluu.agama.supergluu.nickname dn userData scimSetting
// Finish with nickname trigger
Finish nicknameTrigger